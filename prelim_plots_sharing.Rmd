---
title: "IOH and dengue updates"
author: "Alyson Singleton"
date: "`r Sys.Date()`"
output:
  html_document: default
  pdf_document: default
---
```{r setup, include=FALSE}
# install packages, load libraries, set themes, knit formatting
pacman::p_load(tidyverse, dplyr, kableExtra, knitr, sf, raster, terra, spData, tmap, leaflet, ggplot2, spThin, mapdata, rnaturalearth, rnaturalearthdata, brazilmaps, devtools, brazilmaps, mapview, grid, gridExtra, RColorBrewer, raster, plm, fixest)
theme_set(theme_bw())
knitr::opts_chunk$set(echo = F, results='asis', warning=F, message=F, cache=T,
                      fig.height=5, fig.width=10)

get_legend<-function(myggplot){
  tmp <- ggplot_gtable(ggplot_build(myggplot))
  leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
  legend <- tmp$grobs[[leg]]
  return(legend)
}

library(showtext)
font_add("Arial", "/Library/Fonts/Arial.ttf")  # Use the actual file path
showtext_auto()
```

# Dengue plots

## Yearly incidence

#### Including all spatial units, varying near/far cut point (1km, 5km, 10km). Vertical line at 2008.

```{r}
#incidence_data <- read.csv("~/Desktop/doctorate/ch2 mdd highway/data/yearly_incidence_data.csv")
incidence_data <- read.csv("~/Desktop/doctorate/ch2 mdd highway/data/yearly_incidence_data_pop_adjusted.csv")
incidence_data$year <- as.Date(incidence_data$year)
incidence_data$onekm <- as.character(incidence_data$onekm)
incidence_data$fivekm <- as.character(incidence_data$fivekm)
incidence_data$tenkm <- as.character(incidence_data$tenkm)
incidence_data_nopm <- incidence_data[!(incidence_data$cluster %in% 1),]

vert_line_date <- as.Date('2008-01-01')
#plots
#onekm
onekm_plotting <- incidence_data %>%
  group_by(onekm, year) %>%
  summarize(new_incidence = sum(yearly_cases)/sum(population))

ggplot(onekm_plotting) +
  geom_line(aes(x=year, y=new_incidence, colour=onekm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Yearly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>1km (far)', '<1km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

#fivekm
fivekm_plotting <- incidence_data %>%
  group_by(fivekm, year) %>%
  summarize(new_incidence = sum(yearly_cases)/sum(population))

ggplot(fivekm_plotting) +
  geom_line(aes(x=year, y=new_incidence, colour=fivekm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Yearly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>5km (far)', '<5km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

#tenkm
tenkm_plotting <- incidence_data %>%
  group_by(tenkm, year) %>%
  summarize(new_incidence = sum(yearly_cases)/sum(population))

ggplot(tenkm_plotting) +
  geom_line(aes(x=year, y=new_incidence, colour=tenkm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Yearly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>10km (far)', '<10km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

``` 


```{r, eval=F}
#### Removing Puerto Maldonado spatial unit, varying near/far cut point (1km, 5km, 10km). Vertical line at 2008.
incidence_data <- read.csv("~/Desktop/doctorate/ch2 mdd highway/data/yearly_incidence_data.csv")
incidence_data$year <- as.Date(incidence_data$year)
incidence_data$onekm <- as.character(incidence_data$onekm)
incidence_data$fivekm <- as.character(incidence_data$fivekm)
incidence_data$tenkm <- as.character(incidence_data$tenkm)
incidence_data_nopm <- incidence_data[!(incidence_data$cluster %in% 1),]

#plots
#onekm
onekm_plotting <- incidence_data_nopm %>%
  group_by(onekm, year) %>%
  summarize(new_incidence = sum(yearly_cases)/sum(population))

ggplot(onekm_plotting) +
  geom_line(aes(x=year, y=new_incidence, colour=onekm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Yearly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>1km (far)', '<1km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

#fivekm
fivekm_plotting <- incidence_data_nopm %>%
  group_by(fivekm, year) %>%
  summarize(new_incidence = sum(yearly_cases)/sum(population))

ggplot(fivekm_plotting) +
  geom_line(aes(x=year, y=new_incidence, colour=fivekm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Yearly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>5km (far)', '<5km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

#tenkm
tenkm_plotting <- incidence_data_nopm %>%
  group_by(tenkm, year) %>%
  summarize(new_incidence = sum(yearly_cases)/sum(population))

ggplot(tenkm_plotting) +
  geom_line(aes(x=year, y=new_incidence, colour=tenkm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Yearly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>10km (far)', '<10km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

``` 

## Preliminary diff-in-diff results

#### Yearly dengue incidence w 5km boundary, standard errors clustered at district & yearly levels. Baseline year is 2008 (year before hypothesized "shock"). Puerto Maldonado included.

```{r}
### yearly model
incidence_data_yearly <- read.csv("~/Desktop/doctorate/ch2 mdd highway/data/yearly_incidence_data_pop_adjusted.csv")
incidence_data_yearly$incidence <- incidence_data_yearly$yearly_cases/incidence_data_yearly$population
incidence_data_yearly$year <- as.factor(incidence_data_yearly$year)
incidence_data_yearly$onekm <- as.numeric(incidence_data_yearly$onekm)
incidence_data_yearly_no_pm <- incidence_data_yearly[!(incidence_data_yearly$cluster %in% 1),]

test <- feols(incidence ~ i(year, fivekm, ref = '2008-01-01') | cluster + year, vcov = "twoway", data = incidence_data_yearly)
#test <- feols(incidence ~ i(year, tenkm, ref = '2008-01-01') | cluster + year, vcov = "cluster", data = incidence_data_yearly)
#test <- feols(incidence ~ i(year, tenkm, ref = '2008-01-01') | cluster + year, data = incidence_data_yearly)
#summary(test)
#class(test)

df <- as.data.frame(test$coeftable)
colnames(df) <- c('estimate', 'std_error', 't_value', 'p_value')
df$year <- c(seq(as.Date("2000-01-01"), as.Date("2007-01-01"), by="year"),
             seq(as.Date("2009-01-01"), as.Date("2020-01-01"), by="year"))
df$upper <- df$estimate+df$std_error
df$lower <- df$estimate-df$std_error
dengue_yearly_did <- ggplot(df) +
  geom_hline(aes(yintercept=0), colour='red', size=.4) +
  geom_errorbar(aes(x=year, ymax=upper, ymin=lower), width=0, size=0.5) +
  geom_vline(aes(xintercept=as.Date("2008-01-01")), linetype='dashed', size=0.4) +
  geom_point(aes(x=as.Date("2008-01-01"), y=0), size=3, shape=21, fill='white') +
  geom_point(aes(year, estimate), size=3, shape=21, fill='white') +
  xlab("Year") + ylab("Yearly\nincidence") + 
  theme_bw()+
  ylim(c(-0.02,0.135))+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=18),
        axis.title.y=element_text(size=14,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=12),
        axis.title.x=element_text(size=14),
        axis.text.x=element_text(size=12),
        axis.text = element_text(size=14),
        legend.text=element_text(size=12),
        legend.title=element_text(size=12),
        legend.position = "right",
        strip.text.x = element_text(size = 12))
dengue_yearly_did
```

## Quarterly incidence

#### Including all spatial units, varying near/far cut point (1km, 5km, 10km). Vertical line at 2008.

```{r}
incidence_data <- read.csv("~/Desktop/doctorate/ch2 mdd highway/data/monthly_incidence_data.csv")
incidence_data$month <- as.Date(incidence_data$month)
incidence_data$onekm <- as.character(incidence_data$onekm)
incidence_data$fivekm <- as.character(incidence_data$fivekm)
incidence_data$tenkm <- as.character(incidence_data$tenkm)
incidence_data_nopm <- incidence_data[!(incidence_data$cluster %in% 1),]

incidence_data_quarterly <- incidence_data %>% 
  group_by(quarter = lubridate::quarter(month, type = "date_last"), cluster)
incidence_data_quarterly <- incidence_data_quarterly  %>%
  group_by(quarter,cluster) %>%
  summarize(quarterly_cases = sum(monthly_cases),
            onekm=max(onekm),
            fivekm=max(fivekm),
            tenkm=max(tenkm),
            population=mean(population)) 
  
#plots
#onekm
onekm_plotting <- incidence_data_quarterly %>%
  group_by(onekm, quarter) %>%
  summarize(new_incidence = sum(quarterly_cases)/sum(population))

ggplot(onekm_plotting) +
  geom_line(aes(x=quarter, y=new_incidence, colour=onekm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Quarterly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>1km (far)', '<1km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

#fivekm
fivekm_plotting <- incidence_data_quarterly %>%
  group_by(fivekm, quarter) %>%
  summarize(new_incidence = sum(quarterly_cases)/sum(population))

ggplot(fivekm_plotting) +
  geom_line(aes(x=quarter, y=new_incidence, colour=fivekm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Quarterly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>5km (far)', '<5km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

#tenkm
tenkm_plotting <- incidence_data_quarterly %>%
  group_by(tenkm, quarter) %>%
  summarize(new_incidence = sum(quarterly_cases)/sum(population))

ggplot(tenkm_plotting) +
  geom_line(aes(x=quarter, y=new_incidence, colour=tenkm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Quarterly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>10km (far)', '<10km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

``` 

```{r}
### yearly model
incidence_data_yearly <- read.csv("~/Desktop/doctorate/ch2 mdd highway/data/quarterly_incidence_data.csv")
incidence_data_yearly$incidence <- incidence_data_yearly$quarterly_cases/incidence_data_yearly$population
incidence_data_yearly$quarter <- as.factor(incidence_data_yearly$quarter)
incidence_data_yearly$onekm <- as.numeric(incidence_data_yearly$onekm)
incidence_data_yearly_no_pm <- incidence_data_yearly[!(incidence_data_yearly$cluster %in% 1),]

test <- feols(incidence ~ i(quarter, fivekm, ref = '2008-12-31') | cluster + quarter, vcov = "twoway", data = incidence_data_yearly)
#test <- feols(incidence ~ i(year, tenkm, ref = '2008-01-01') | cluster + year, vcov = "cluster", data = incidence_data_yearly)
#test <- feols(incidence ~ i(year, tenkm, ref = '2008-01-01') | cluster + year, data = incidence_data_yearly)
#summary(test)
#class(test)

df <- as.data.frame(test$coeftable)
colnames(df) <- c('estimate', 'std_error', 't_value', 'p_value')
df$quarter <- c(seq(as.Date("2000-01-01"), as.Date("2008-09-30"), by="quarter"),
                seq(as.Date("2009-01-01"), as.Date("2020-12-31"), by="quarter"))
df$upper <- df$estimate+df$std_error
df$lower <- df$estimate-df$std_error
dengue_quarterly_did <- ggplot(df) +
  geom_hline(aes(yintercept=0), colour='red', size=.4) +
  geom_errorbar(aes(x=quarter, ymax=upper, ymin=lower), width=0, size=0.5) +
  geom_vline(aes(xintercept=as.Date("2008-01-01")), linetype='dashed', size=0.4) +
  geom_point(aes(x=as.Date("2008-01-01"), y=0), size=3, shape=21, fill='white') +
  geom_point(aes(quarter, estimate), size=3, shape=21, fill='white') +
  xlab("Year") + ylab("Quarterly\nincidence") + 
  theme_bw()+
  ylim(c(-0.02,0.20))+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=18),
        axis.title.y=element_text(size=14,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=12),
        axis.title.x=element_text(size=14),
        axis.text.x=element_text(size=12),
        axis.text = element_text(size=14),
        legend.text=element_text(size=12),
        legend.title=element_text(size=12),
        legend.position = "right",
        strip.text.x = element_text(size = 12))
dengue_quarterly_did
```

```{r, eval=F}
#### Removing Puerto Maldonado spatial unit, varying near/far cut point (1km, 5km, 10km). Vertical line at 2008.

incidence_data_nopm <- incidence_data_quarterly[!(incidence_data_quarterly$cluster %in% 1),]

#plots
#onekm
onekm_plotting <- incidence_data_quarterly %>%
  group_by(onekm, quarter) %>%
  summarize(new_incidence = sum(quarterly_cases)/sum(population))

ggplot(onekm_plotting) +
  geom_line(aes(x=quarter, y=new_incidence, colour=onekm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Quarterly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>1km (far)', '<1km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

#fivekm
fivekm_plotting <- incidence_data_quarterly %>%
  group_by(fivekm, quarter) %>%
  summarize(new_incidence = sum(quarterly_cases)/sum(population))

ggplot(fivekm_plotting) +
  geom_line(aes(x=quarter, y=new_incidence, colour=fivekm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Quarterly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>5km (far)', '<5km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

#tenkm
tenkm_plotting <- incidence_data_quarterly %>%
  group_by(tenkm, quarter) %>%
  summarize(new_incidence = sum(quarterly_cases)/sum(population))

ggplot(tenkm_plotting) +
  geom_line(aes(x=quarter, y=new_incidence, colour=tenkm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Quarterly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>10km (far)', '<10km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

``` 

```{r, Monthly incidence, eval=F}
incidence_data <- read.csv("~/Desktop/doctorate/ch2 mdd highway/data/monthly_incidence_data.csv")
incidence_data$month <- as.Date(incidence_data$month)
incidence_data$onekm <- as.character(incidence_data$onekm)
incidence_data$fivekm <- as.character(incidence_data$fivekm)
incidence_data$tenkm <- as.character(incidence_data$tenkm)
incidence_data_nopm <- incidence_data[!(incidence_data$cluster %in% 1),]

incidence_data_quarterly <- incidence_data %>% 
  group_by(quarter = lubridate::quarter(month, type = "date_last"), cluster)
incidence_data_quarterly <- incidence_data_quarterly  %>%
  group_by(quarter,cluster) %>%
  summarize(quarterly_cases = sum(monthly_cases),
            onekm=max(onekm),
            fivekm=max(fivekm),
            tenkm=max(tenkm),
            population=mean(population)) 
  
#plots
#onekm
onekm_plotting <- incidence_data %>%
  group_by(onekm, month) %>%
  summarize(new_incidence = sum(monthly_cases)/sum(population))

ggplot(onekm_plotting) +
  geom_line(aes(x=month, y=new_incidence, colour=onekm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Monthly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>1km (far)', '<1km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

#fivekm
fivekm_plotting <- incidence_data %>%
  group_by(fivekm, month) %>%
  summarize(new_incidence = sum(monthly_cases)/sum(population))

ggplot(fivekm_plotting) +
  geom_line(aes(x=month, y=new_incidence, colour=fivekm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Monthly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>5km (far)', '<5km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

#tenkm
tenkm_plotting <- incidence_data %>%
  group_by(tenkm, month) %>%
  summarize(new_incidence = sum(monthly_cases)/sum(population))

ggplot(tenkm_plotting) +
  geom_line(aes(x=month, y=new_incidence, colour=tenkm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Monthly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>10km (far)', '<10km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

``` 

```{r, Monthly incidence no PM, eval=F}
incidence_data_nopm <- incidence_data[!(incidence_data$cluster %in% 1),]

#plots
#onekm
onekm_plotting <- incidence_data_nopm %>%
  group_by(onekm, month) %>%
  summarize(new_incidence = sum(monthly_cases)/sum(population))

ggplot(onekm_plotting) +
  geom_line(aes(x=month, y=new_incidence, colour=onekm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Monthly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>1km (far)', '<1km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

#fivekm
fivekm_plotting <- incidence_data_nopm %>%
  group_by(fivekm, month) %>%
  summarize(new_incidence = sum(monthly_cases)/sum(population))

ggplot(fivekm_plotting) +
  geom_line(aes(x=month, y=new_incidence, colour=fivekm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Monthly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>5km (far)', '<5km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

#tenkm
tenkm_plotting <- incidence_data_nopm %>%
  group_by(tenkm, month) %>%
  summarize(new_incidence = sum(monthly_cases)/sum(population))

ggplot(tenkm_plotting) +
  geom_line(aes(x=month, y=new_incidence, colour=tenkm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Monthly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>10km (far)', '<10km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

``` 

# Leish plots

## Yearly incidence

#### Including all spatial units, varying near/far cut point (1km, 5km, 10km). Vertical line at 2008.

```{r}
incidence_data <- read.csv("~/Desktop/doctorate/ch2 mdd highway/data/yearly_leish_incidence_data_pop_adjusted.csv")
incidence_data$year <- as.Date(incidence_data$year)
incidence_data$onekm <- as.character(incidence_data$onekm)
incidence_data$fivekm <- as.character(incidence_data$fivekm)
incidence_data$tenkm <- as.character(incidence_data$tenkm)
incidence_data_nopm <- incidence_data[!(incidence_data$cluster %in% 1),]

vert_line_date <- as.Date('2008-01-01')
#plots
#onekm
onekm_plotting <- incidence_data %>%
  group_by(onekm, year) %>%
  summarize(new_incidence = sum(yearly_cases)/sum(population))

ggplot(onekm_plotting) +
  geom_line(aes(x=year, y=new_incidence, colour=onekm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Yearly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>1km (far)', '<1km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

#fivekm
fivekm_plotting <- incidence_data %>%
  group_by(fivekm, year) %>%
  summarize(new_incidence = sum(yearly_cases)/sum(population))

ggplot(fivekm_plotting) +
  geom_line(aes(x=year, y=new_incidence, colour=fivekm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Yearly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>5km (far)', '<5km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

#tenkm
tenkm_plotting <- incidence_data %>%
  group_by(tenkm, year) %>%
  summarize(new_incidence = sum(yearly_cases)/sum(population))

ggplot(tenkm_plotting) +
  geom_line(aes(x=year, y=new_incidence, colour=tenkm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Yearly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>10km (far)', '<10km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

``` 

## Preliminary diff-in-diff results

#### Yearly leishmaniasis incidence w 5km boundary, standard errors clustered at district & yearly levels. Baseline year is 2008 (year before hypothesized "shock"). Puerto Maldonado included.

```{r}
### yearly model
incidence_data_yearly <- read.csv("~/Desktop/doctorate/ch2 mdd highway/data/yearly_leish_incidence_data_pop_adjusted.csv")
incidence_data_yearly$incidence <- incidence_data_yearly$yearly_cases/incidence_data_yearly$population
incidence_data_yearly$year <- as.factor(incidence_data_yearly$year)
incidence_data_yearly$onekm <- as.numeric(incidence_data_yearly$onekm)
incidence_data_yearly_no_pm <- incidence_data_yearly[!(incidence_data_yearly$cluster %in% 1),]

test <- feols(incidence ~ i(year, fivekm, ref = '2008-01-01') | cluster + year, vcov = "twoway", data = incidence_data_yearly)
#test <- feols(incidence ~ i(year, tenkm, ref = '2008-01-01') | cluster + year, vcov = "cluster", data = incidence_data_yearly)
#test <- feols(incidence ~ i(year, tenkm, ref = '2008-01-01') | cluster + year, data = incidence_data_yearly)
#summary(test)
#class(test)

df <- as.data.frame(test$coeftable)
colnames(df) <- c('estimate', 'std_error', 't_value', 'p_value')
df$year <- c(seq(as.Date("2000-01-01"), as.Date("2007-01-01"), by="year"),
             seq(as.Date("2009-01-01"), as.Date("2020-01-01"), by="year"))
df$upper <- df$estimate+df$std_error
df$lower <- df$estimate-df$std_error
leish_yearly_did <- ggplot(df) +
  geom_hline(aes(yintercept=0), colour='red', size=.4) +
  geom_errorbar(aes(x=year, ymax=upper, ymin=lower), width=0, size=0.5) +
  geom_vline(aes(xintercept=as.Date("2008-01-01")), linetype='dashed', size=0.4) +
  geom_point(aes(x=as.Date("2008-01-01"), y=0), size=3, shape=21, fill='white') +
  geom_point(aes(year, estimate), size=3, shape=21, fill='white') +
  xlab("Year") + ylab("Yearly\nincidence") + 
  theme_bw()+
  ylim(c(-0.02,0.135))+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=18),
        axis.title.y=element_text(size=14,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=12),
        axis.title.x=element_text(size=14),
        axis.text.x=element_text(size=12),
        axis.text = element_text(size=14),
        legend.text=element_text(size=12),
        legend.title=element_text(size=12),
        legend.position = "right",
        strip.text.x = element_text(size = 12))
leish_yearly_did
```

```{r, eval=F}
#### Removing Puerto Maldonado spatial unit, varying near/far cut point (1km, 5km, 10km). Vertical line at 2008.

incidence_data <- read.csv("~/Desktop/doctorate/ch2 mdd highway/data/yearly_leish_incidence_data.csv")
incidence_data$year <- as.Date(incidence_data$year)
incidence_data$onekm <- as.character(incidence_data$onekm)
incidence_data$fivekm <- as.character(incidence_data$fivekm)
incidence_data$tenkm <- as.character(incidence_data$tenkm)
incidence_data_nopm <- incidence_data[!(incidence_data$cluster %in% 1),]

#plots
#onekm
onekm_plotting <- incidence_data_nopm %>%
  group_by(onekm, year) %>%
  summarize(new_incidence = sum(yearly_cases)/sum(population))

ggplot(onekm_plotting) +
  geom_line(aes(x=year, y=new_incidence, colour=onekm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Yearly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>1km (far)', '<1km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

#fivekm
fivekm_plotting <- incidence_data_nopm %>%
  group_by(fivekm, year) %>%
  summarize(new_incidence = sum(yearly_cases)/sum(population))

ggplot(fivekm_plotting) +
  geom_line(aes(x=year, y=new_incidence, colour=fivekm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Yearly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>5km (far)', '<5km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

#tenkm
tenkm_plotting <- incidence_data_nopm %>%
  group_by(tenkm, year) %>%
  summarize(new_incidence = sum(yearly_cases)/sum(population))

ggplot(tenkm_plotting) +
  geom_line(aes(x=year, y=new_incidence, colour=tenkm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Yearly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>10km (far)', '<10km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

``` 


## Quarterly incidence

#### Including all spatial units, varying near/far cut point (1km, 5km, 10km). Vertical line at 2008.

```{r}
incidence_data <- read.csv("~/Desktop/doctorate/ch2 mdd highway/data/quarterly_leish_incidence_data_pop_adjusted.csv")
incidence_data$quarter <- as.Date(incidence_data$quarter)
incidence_data$onekm <- as.character(incidence_data$onekm)
incidence_data$fivekm <- as.character(incidence_data$fivekm)
incidence_data$tenkm <- as.character(incidence_data$tenkm)
incidence_data_nopm <- incidence_data[!(incidence_data$cluster %in% 1),]
  
#plots
#onekm
onekm_plotting <- incidence_data %>%
  group_by(onekm, quarter) %>%
  summarize(new_incidence = sum(quarterly_cases)/sum(population))

ggplot(onekm_plotting) +
  geom_line(aes(x=quarter, y=new_incidence, colour=onekm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Quarterly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>1km (far)', '<1km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

#fivekm
fivekm_plotting <- incidence_data %>%
  group_by(fivekm, quarter) %>%
  summarize(new_incidence = sum(quarterly_cases)/sum(population))

ggplot(fivekm_plotting) +
  geom_line(aes(x=quarter, y=new_incidence, colour=fivekm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Quarterly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>5km (far)', '<5km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

#tenkm
tenkm_plotting <- incidence_data %>%
  group_by(tenkm, quarter) %>%
  summarize(new_incidence = sum(quarterly_cases)/sum(population))

ggplot(tenkm_plotting) +
  geom_line(aes(x=quarter, y=new_incidence, colour=tenkm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Quarterly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>10km (far)', '<10km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

``` 

```{r}
### yearly model
incidence_data_yearly <- read.csv("~/Desktop/doctorate/ch2 mdd highway/data/quarterly_leish_incidence_data_pop_adjusted.csv")
incidence_data_yearly$incidence <- incidence_data_yearly$quarterly_cases/incidence_data_yearly$population
incidence_data_yearly$quarter <- as.factor(incidence_data_yearly$quarter)
incidence_data_yearly$onekm <- as.numeric(incidence_data_yearly$onekm)
incidence_data_yearly_no_pm <- incidence_data_yearly[!(incidence_data_yearly$cluster %in% 1),]

test <- feols(incidence ~ i(quarter, fivekm, ref = '2008-12-31') | cluster + quarter, vcov = "twoway", data = incidence_data_yearly)
#test <- feols(incidence ~ i(year, tenkm, ref = '2008-01-01') | cluster + year, vcov = "cluster", data = incidence_data_yearly)
#test <- feols(incidence ~ i(year, tenkm, ref = '2008-01-01') | cluster + year, data = incidence_data_yearly)
#summary(test)
#class(test)

df <- as.data.frame(test$coeftable)
colnames(df) <- c('estimate', 'std_error', 't_value', 'p_value')
df$quarter <- c(seq(as.Date("2000-01-01"), as.Date("2008-09-30"), by="quarter"),
                seq(as.Date("2009-01-01"), as.Date("2020-12-31"), by="quarter"))
df$upper <- df$estimate+df$std_error
df$lower <- df$estimate-df$std_error
leish_quarterly_did <- ggplot(df) +
  geom_hline(aes(yintercept=0), colour='red', size=.4) +
  geom_errorbar(aes(x=quarter, ymax=upper, ymin=lower), width=0, size=0.5) +
  geom_vline(aes(xintercept=as.Date("2008-01-01")), linetype='dashed', size=0.4) +
  geom_point(aes(x=as.Date("2008-01-01"), y=0), size=3, shape=21, fill='white') +
  geom_point(aes(quarter, estimate), size=3, shape=21, fill='white') +
  xlab("Year") + ylab("Quarterly\nincidence") + 
  theme_bw()+
  ylim(c(-0.02,0.20))+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=18),
        axis.title.y=element_text(size=14,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=12),
        axis.title.x=element_text(size=14),
        axis.text.x=element_text(size=12),
        axis.text = element_text(size=14),
        legend.text=element_text(size=12),
        legend.title=element_text(size=12),
        legend.position = "right",
        strip.text.x = element_text(size = 12))
leish_quarterly_did
```

```{r, eval=F}
#### Removing Puerto Maldonado spatial unit, varying near/far cut point (1km, 5km, 10km). Vertical line at 2008.

#plots
#onekm
onekm_plotting <- incidence_data_nopm %>%
  group_by(onekm, quarter) %>%
  summarize(new_incidence = sum(quarterly_cases)/sum(population))

ggplot(onekm_plotting) +
  geom_line(aes(x=quarter, y=new_incidence, colour=onekm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Quarterly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>1km (far)', '<1km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

#fivekm
fivekm_plotting <- incidence_data_nopm %>%
  group_by(fivekm, quarter) %>%
  summarize(new_incidence = sum(quarterly_cases)/sum(population))

ggplot(fivekm_plotting) +
  geom_line(aes(x=quarter, y=new_incidence, colour=fivekm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Quarterly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>5km (far)', '<5km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

#tenkm
tenkm_plotting <- incidence_data_nopm %>%
  group_by(tenkm, quarter) %>%
  summarize(new_incidence = sum(quarterly_cases)/sum(population))

ggplot(tenkm_plotting) +
  geom_line(aes(x=quarter, y=new_incidence, colour=tenkm)) +
  geom_vline(xintercept=vert_line_date,linetype='dashed') +
  #labs(color="Model Type") +
  #ggtitle("B. straminea") +
  xlab("Year") + ylab("Quarterly\nincidence") + 
  scale_color_manual(values=c('#3ecbdd', '#FFBC42'), labels=c('>10km (far)', '<10km (near)')) + 
  theme_bw()+
  theme(plot.title = element_text(hjust=0.5, size=26, face="italic"),
        plot.subtitle = element_text(hjust=0.5, size=22),
        axis.title=element_text(size=22),
        axis.title.y=element_text(size=16,angle=0, vjust=.5, hjust=0.5),
        axis.text.y=element_text(size=16),
        axis.title.x=element_text(size=16),
        axis.text.x=element_text(size=16),
        axis.text = element_text(size=16),
        legend.text=element_text(size=14),
        legend.title=element_text(size=14),
        legend.position = "right",
        strip.text.x = element_text(size = 14))

``` 

## Easier diff-in-diff comparison between the two disease systems

```{r}
dengue_yearly_did + ggtitle("Dengue yearly")
leish_yearly_did + ggtitle("Leish yearly")
dengue_quarterly_did + ggtitle("Dengue quarterly")
leish_quarterly_did + ggtitle("Leish quarterly")
```